(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[176],{29:function(e,t,a){Promise.resolve().then(a.bind(a,4416))},4416:function(e,t,a){"use strict";a.d(t,{MessageWindow:function(){return v}});var n=a(7437),r=a(4304),l=a(2265),i=a(3102),o=a(495),s=a(1647),d=a(2746);function c(e){var t;let{onSend:a,disabled:r,mePhotoUrl:c}=e,[u,m]=(0,l.useState)(""),{user:h}=(0,d.a)(),f=async e=>{e.preventDefault(),u.trim()&&(await a(u.trim()),m(""))};return(0,n.jsxs)("form",{onSubmit:f,className:"flex items-center gap-3",children:[(0,n.jsx)(s.q,{src:null!=c?c:null,alt:null!==(t=null==h?void 0:h.email)&&void 0!==t?t:"You",className:"h-8 w-8"}),(0,n.jsx)(i.I,{value:u,onChange:e=>m(e.target.value),placeholder:"Type a message",disabled:r}),(0,n.jsx)(o.z,{type:"submit",disabled:r||!u.trim(),children:"Send"})]})}var u=a(6013),m=a(6463),h=a(7776);let f=async e=>{let t=await fetch(e);if(!t.ok)throw Error("Unable to load messages");return t.json()};function v(e){var t,a,i;let{matchId:o}=e,{user:v}=(0,d.a)(),p=(0,m.useRouter)(),{data:x,mutate:w}=(0,r.ZP)("/api/matches/".concat(o,"/messages"),f,{refreshInterval:5e3}),[g,b]=(0,l.useState)(!1),[y,N]=(0,l.useState)(!1);(0,l.useEffect)(()=>{x&&fetch("/api/matches/".concat(o,"/messages/read"),{method:"POST"})},[x,o]);let j=async e=>{b(!0);try{await fetch("/api/matches/".concat(o,"/messages"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({matchId:o,body:e,type:"text"})}),w()}finally{b(!1)}},I=async()=>{if(window.confirm("Delete this chat? This will remove all messages.")){N(!0);try{(await fetch("/api/matches/".concat(o),{method:"DELETE"})).ok?(h.Am.success("Chat deleted"),p.push("/matches")):h.Am.error("Could not delete chat")}finally{N(!1)}}},E=null!==(a=null==x?void 0:x.messages)&&void 0!==a?a:[],S=null==x?void 0:x.peer;return(0,n.jsx)(u.Zb,{children:(0,n.jsxs)(u.aY,{className:"flex h-[70vh] flex-col gap-4 p-6",children:[S&&(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3 border-b border-slate-200 pb-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(s.q,{src:S.photoUrl||null,alt:S.name,className:"h-10 w-10"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-slate-900",children:S.name}),(0,n.jsx)("p",{className:"text-xs text-slate-500",children:"Active mentorship"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{type:"button",onClick:()=>void(async()=>{await fetch("/api/matches/".concat(o),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"hide"})}),p.push("/matches")})(),disabled:y,className:"rounded-xl border border-slate-300 px-3 py-1.5 text-xs text-slate-600 hover:bg-slate-100",children:"Hide"}),(0,n.jsx)("button",{type:"button",onClick:()=>void I(),disabled:y,className:"rounded-xl border border-red-300 px-3 py-1.5 text-xs text-red-600 hover:bg-red-50",children:y?"Deletingâ€¦":"Delete"})]})]}),(0,n.jsxs)("div",{className:"flex-1 space-y-3 overflow-y-auto rounded-2xl bg-slate-100 p-4",children:[E.map(e=>{var t,a,r,l,i,o;let d=(null==v?void 0:v.uid)&&e.senderId===v.uid;return(0,n.jsx)("div",{className:d?"flex justify-end":"flex justify-start",children:(0,n.jsxs)("div",{className:"flex max-w-[80%] items-end gap-2 ".concat(d?"flex-row-reverse":"flex-row"),children:[(0,n.jsx)(s.q,{src:d?null!==(l=null==x?void 0:null===(t=x.me)||void 0===t?void 0:t.photoUrl)&&void 0!==l?l:null:null!==(i=null==x?void 0:null===(a=x.peer)||void 0===a?void 0:a.photoUrl)&&void 0!==i?i:null,alt:d?"You":null!==(o=null==x?void 0:null===(r=x.peer)||void 0===r?void 0:r.name)&&void 0!==o?o:"User",className:"h-8 w-8"}),(0,n.jsx)("div",{className:"".concat(d?"bg-brand-600 text-white":"bg-white text-slate-700"," rounded-2xl px-3 py-2 shadow-sm"),children:(0,n.jsx)("p",{className:"whitespace-pre-wrap break-words text-sm",children:e.body})})]})},e.id)}),0===E.length&&(0,n.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-3 text-center",children:[(0,n.jsx)("img",{src:"https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?q=80&w=1200&auto=format&fit=crop",alt:"Warm table with tea",className:"h-24 w-24 rounded-2xl object-cover shadow-soft",loading:"lazy"}),(0,n.jsx)("p",{className:"text-sm text-slate-500",children:"No messages yet. Start the conversation!"})]})]}),(0,n.jsx)(c,{onSend:j,disabled:g,mePhotoUrl:null!==(i=null==x?void 0:null===(t=x.me)||void 0===t?void 0:t.photoUrl)&&void 0!==i?i:null})]})})}},1647:function(e,t,a){"use strict";a.d(t,{q:function(){return i}});var n=a(7437);a(2265);var r=a(6648),l=a(4655);function i(e){let{src:t,alt:a,fallback:i,className:o,...s}=e;return(0,n.jsx)("div",{className:(0,l.cn)("relative flex h-14 w-14 items-center justify-center overflow-hidden rounded-full bg-brand-100 text-brand-700",o),...s,children:t?(0,n.jsx)(r.default,{src:t,alt:a,fill:!0,className:"object-cover",sizes:"56px"}):(0,n.jsx)("span",{className:"text-lg font-semibold",children:null!=i?i:a.substring(0,2).toUpperCase()})})}},495:function(e,t,a){"use strict";a.d(t,{z:function(){return d}});var n=a(7437),r=a(2265),l=a(1538),i=a(3027),o=a(4655);let s=(0,i.j)("inline-flex items-center justify-center gap-2 rounded-2xl px-4 py-2 text-sm font-semibold transition-all duration-200 ease-out active:scale-95 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-60",{variants:{variant:{default:"bg-brand-500 text-white shadow-soft hover:bg-brand-600",outline:"border border-slate-200 bg-white text-slate-900 hover:bg-slate-50",ghost:"text-brand-600 hover:bg-brand-50",destructive:"bg-red-600 text-white hover:bg-red-700"},size:{default:"h-10 px-4 py-2",sm:"h-9 px-3",lg:"h-11 px-6 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:a,variant:r,size:i,asChild:d=!1,...c}=e,u=d?l.g7:"button";return(0,n.jsx)(u,{className:(0,o.cn)(s({variant:r,size:i,className:a})),ref:t,...c})});d.displayName="Button"},6013:function(e,t,a){"use strict";a.d(t,{Zb:function(){return i},aY:function(){return o}});var n=a(7437),r=a(2265),l=a(4655);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("rounded-2xl border border-slate-100 bg-white shadow-soft transition duration-300 ease-out will-change-transform hover:-translate-y-0.5 hover:shadow-soft",a),...r})});i.displayName="Card",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("space-y-1.5 p-6",a),...r})}).displayName="CardHeader",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("h3",{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight text-slate-900",a),...r})}).displayName="CardTitle",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-slate-500",a),...r})}).displayName="CardDescription";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...r})});o.displayName="CardContent",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...r})}).displayName="CardFooter"},3102:function(e,t,a){"use strict";a.d(t,{I:function(){return i}});var n=a(7437),r=a(2265),l=a(4655);let i=r.forwardRef((e,t)=>{let{className:a,type:r,...i}=e;return(0,n.jsx)("input",{type:r,className:(0,l.cn)("flex h-11 w-full rounded-2xl border border-slate-200 bg-white px-4 py-2 text-sm shadow-sm transition-all placeholder:text-slate-400 focus-visible:border-brand-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-200",a),ref:t,...i})});i.displayName="Input"},2746:function(e,t,a){"use strict";a.d(t,{H:function(){return p},a:function(){return x}});var n,r=a(7437),l=a(2265),i=a(5735),o=a(5236);a(9842);var s=a(9854),d=a(357);let c={apiKey:d.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:d.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:d.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:d.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:d.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:d.env.NEXT_PUBLIC_FIREBASE_APP_ID};d.env.FIREBASE_PROJECT_ID||d.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,d.env.FIREBASE_CLIENT_EMAIL,null===(n=d.env.FIREBASE_PRIVATE_KEY)||void 0===n||n.replace(/\\n/g,"\n");let u=!1;var m=a(356),h=a(6463),f=a(2649);let v=(0,l.createContext)(void 0);function p(e){let{children:t}=e,[n,d]=(0,l.useState)(null),[p,x]=(0,l.useState)(!0),w=(0,h.useRouter)(),g=(0,l.useMemo)(()=>m.s?null:(!function(){var e;(0,o.C6)().length||(0,o.ZF)(c);let t=null===(e=window.location)||void 0===e?void 0:e.hostname;if(("localhost"===t||"127.0.0.1"===t)&&!u)try{let e=(0,s.cF)();(0,s.a1)(e,"127.0.0.1",9199),u=!0}catch(e){}}(),(0,i.v0)()),[]);(0,l.useEffect)(()=>{if(m.s){d({uid:"demo-user-1",email:"demo@mentormatch.local",displayName:"Demo User",photoURL:null,isAdmin:!0}),x(!1);return}if(!g){x(!1);return}let e=(0,i.Aj)(g,async e=>{if(e){var t;let a=await e.getIdTokenResult(),n=await e.getIdToken();try{let e=await fetch("/api/auth/post-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idToken:n})});e.ok?console.log("post-login successful"):console.error("post-login failed:",e.status,await e.text())}catch(e){console.error("post-login error:",e)}let r=(null===(t=a.claims)||void 0===t?void 0:t.role)==="admin";d({uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,isAdmin:r})}else d(null);x(!1)});return()=>e()},[g]);let b=(0,l.useMemo)(()=>({user:n,loading:p,signOutUser:async()=>{if(m.s){f.Z.remove("onboarding"),d(null),w.push("/");return}if(!g)throw Error("Firebase not initialized");await (0,i.w7)(g),await fetch("/api/auth/logout",{method:"POST"}).catch(()=>void 0),f.Z.remove("onboarding"),w.push("/")},sendMagicLink:async(e,t)=>{var a,n,r;if(m.s){let r=e.trim().toLowerCase();window.localStorage.setItem("emailForSignIn",r),window.localStorage.setItem("authFlow",null!==(a=null==t?void 0:t.mode)&&void 0!==a?a:"sign-in"),d({uid:"demo-user-1",email:r,displayName:null!==(n=r.split("@")[0])&&void 0!==n?n:"Demo User",photoURL:null,isAdmin:!0});return}if(!g)throw Error("Firebase not initialized");let l=e.trim(),o=new URL("/complete",window.location.origin),s=null!==(r=null==t?void 0:t.mode)&&void 0!==r?r:"sign-in";o.searchParams.set("mode",s);let c={url:o.toString(),handleCodeInApp:!0};await (0,i.oo)(g,l,c),window.localStorage.setItem("emailForSignIn",l),window.localStorage.setItem("authFlow",s)},signInWithMagicLink:async(e,t)=>{if(m.s){var a;let t=e.trim().toLowerCase();d({uid:"demo-user-1",email:t,displayName:null!==(a=t.split("@")[0])&&void 0!==a?a:"Demo User",photoURL:null,isAdmin:!0}),window.localStorage.removeItem("emailForSignIn"),window.localStorage.removeItem("authFlow");return}if(!g)throw Error("Firebase not initialized");let n=e||window.localStorage.getItem("emailForSignIn")||"",r=t||window.location.href;if(!(0,i.JB)(g,r))throw Error("Invalid link");await (0,i.P6)(g,n,r);try{let e=g.currentUser;if(e){let t=await e.getIdToken(!0);try{let e=await fetch("/api/auth/post-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idToken:t})});e.ok||console.error("magic link post-login failed:",e.status,await e.text())}catch(e){console.error("magic link post-login error:",e)}}}catch(e){}window.localStorage.removeItem("emailForSignIn"),window.localStorage.removeItem("authFlow")},signInWithGoogle:async()=>{if(m.s){d({uid:"demo-user-1",email:"demo@mentormatch.local",displayName:"Demo User",photoURL:null,isAdmin:!0}),w.push("/discover");return}if(!g)throw Error("Firebase not initialized");let e=new i.hJ;await (0,i.rh)(g,e),await new Promise(e=>setTimeout(e,1e3));try{let{handlePostAuthRedirect:e}=await a.e(833).then(a.bind(a,5833)),t=await e();w.push(t)}catch(e){console.error("Post-auth routing failed:",e),w.push("/discover")}}}),[g,n,p,w]);return(0,r.jsx)(v.Provider,{value:b,children:t})}function x(){let e=(0,l.useContext)(v);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},356:function(e,t,a){"use strict";a.d(t,{_:function(){return r},s:function(){return n}});let n=!0,r="/mentor-matcher"},4655:function(e,t,a){"use strict";a.d(t,{cn:function(){return l}});var n=a(4839),r=a(6164);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,n.W)(t))}},3027:function(e,t,a){"use strict";a.d(t,{j:function(){return i}});var n=a(4839);let r=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,l=n.W,i=(e,t)=>a=>{var n;if((null==t?void 0:t.variants)==null)return l(e,null==a?void 0:a.class,null==a?void 0:a.className);let{variants:i,defaultVariants:o}=t,s=Object.keys(i).map(e=>{let t=null==a?void 0:a[e],n=null==o?void 0:o[e];if(null===t)return null;let l=r(t)||r(n);return i[e][l]}),d=a&&Object.entries(a).reduce((e,t)=>{let[a,n]=t;return void 0===n||(e[a]=n),e},{});return l(e,s,null==t?void 0:null===(n=t.compoundVariants)||void 0===n?void 0:n.reduce((e,t)=>{let{class:a,className:n,...r}=t;return Object.entries(r).every(e=>{let[t,a]=e;return Array.isArray(a)?a.includes({...o,...d}[t]):({...o,...d})[t]===a})?[...e,a,n]:e},[]),null==a?void 0:a.class,null==a?void 0:a.className)}}},function(e){e.O(0,[358,139,868,776,32,648,913,971,23,744],function(){return e(e.s=29)}),_N_E=e.O()}]);